!function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function e(i){t(this,e),this.marked=i},n=function e(i){t(this,e),this.mineCount=i},o=function e(){t(this,e)},a=function(){function a(e,i,n){t(this,a),this.width=e,this.height=i,this.mineCount=n,this.remainingToOpen=e*i-n,this.gameConclusion=null,this.stateMap=new Array(i);for(var o=0;o<i;o++)this.stateMap[o]=new Array(e);this.mineMap=null}var h,r,s;return h=a,(r=[{key:"getCellAt",value:function(e,t){var a=this.stateMap[t][e];if("revealed"!==a)return new i("marked"===a);if(!this.mineMap)throw"mineMap should be initialized before any cell state is revealed.";var h=this.mineMap[t][e];return"bomb"===h?new o:new n(h)}},{key:"tryToggleMark",value:function(e,t){var i=this.stateMap[t][e];return"revealed"!==i&&(this.stateMap[t][e]="marked"===i?void 0:"marked",!0)}},{key:"tryOpen",value:function(e,t){var i=this.stateMap[t][e];if("revealed"===i||"marked"===i)return!1;if(null===this.mineMap&&this.initializeMines({x:e,y:t}),!this.mineMap)throw"mineMap should be initialized before any cell state is revealed.";return"bomb"===this.mineMap[t][e]?this.explode():this.openKnownGoodCell(e,t),!0}},{key:"openSurroundingIfSatisfied",value:function(e,t){var i=this.getCellAt(e,t);if(i instanceof n){for(var o=this.getSurroundingCoordinates(e,t),a=new Array,h=0,r=0;r<o.length;r++){var s=o[r],l=this.stateMap[s.y][s.x];"marked"===l?h++:"revealed"!==l&&a.push(s)}if(h===i.mineCount){for(var u=0;u<a.length;u++){var d=a[u];if(this.tryOpen(d.x,d.y),this.gameConclusion)break}return!0}}return!1}},{key:"initializeMines",value:function(e){this.mineMap=new Array(this.height);for(var t=0;t<this.height;t++)this.mineMap[t]=new Array(this.width).fill(0);for(var i=0;i<this.mineCount;){var n=Math.floor(Math.random()*this.width),o=Math.floor(Math.random()*this.height);if(!(Math.abs(n-e.x)<=1&&Math.abs(o-e.y)<=1)&&"bomb"!==this.mineMap[o][n]){this.mineMap[o][n]="bomb";for(var a=this.getSurroundingCoordinates(n,o),h=0;h<a.length;h++){var r=a[h],s=this.mineMap[r.y][r.x];"bomb"!==s&&(this.mineMap[r.y][r.x]=s+1)}i++}}console.log(this.mineMap)}},{key:"explode",value:function(){if(!this.mineMap)throw"mineMap should be initialized before any cell state is revealed.";this.gameConclusion="loss";for(var e=0;e<this.height;e++)for(var t=0;t<this.width;t++)"bomb"===this.mineMap[e][t]&&(this.stateMap[e][t]="revealed")}},{key:"openKnownGoodCell",value:function(e,t){if(!this.mineMap)throw"mineMap should be initialized before any cell state is revealed.";for(var i=[{x:e,y:t}];;){var n=i.pop();if(!n)break;var o=this.stateMap[n.y][n.x];if("marked"!==o&&"revealed"!==o){if(this.stateMap[n.y][n.x]="revealed",this.remainingToOpen--,0===this.remainingToOpen){this.gameConclusion="win";break}0===this.mineMap[n.y][n.x]&&(i=i.concat(this.getSurroundingCoordinates(n.x,n.y)))}}}},{key:"getSurroundingCoordinates",value:function(e,t){var i=new Array;return t>0&&i.push({x:e,y:t-1}),t<this.height-1&&i.push({x:e,y:t+1}),e>0&&(i.push({x:e-1,y:t}),t>0&&i.push({x:e-1,y:t-1}),t<this.height-1&&i.push({x:e-1,y:t+1})),e<this.width-1&&(i.push({x:e+1,y:t}),t>0&&i.push({x:e+1,y:t-1}),t<this.height-1&&i.push({x:e+1,y:t+1})),i}},{key:"conclusion",get:function(){return this.gameConclusion}}])&&e(h.prototype,r),s&&e(h,s),a}();function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderSize={width:t,height:i},this.gameSize={width:n,height:o};var a={x:0,y:0,width:this.renderSize.width,height:this.renderSize.height},h={width:n,height:o};this.minefieldBounds=e.fitRectangle(h,a),this.cellSize=this.minefieldBounds.width/n}var t,i,n;return t=e,n=[{key:"fitRectangle",value:function(e,t){if(t.width*e.height<t.height*e.width){var i=t.width*e.height/e.width;return{x:0,y:(t.height-i)/2,width:t.width,height:i}}var n=t.height*e.width/e.height;return{x:(t.width-n)/2,y:0,width:n,height:t.height}}}],(i=[{key:"getCellCoordinatesByMouseLocation",value:function(e){var t=Math.floor((e.x-this.minefieldBounds.x)/this.cellSize);if(t<0||t>=this.gameSize.width)return null;var i=Math.floor((e.y-this.minefieldBounds.y)/this.cellSize);return i<0||i>=this.gameSize.height?null:{x:t,y:i}}},{key:"getCellBorderX",value:function(e){return Math.floor(this.minefieldBounds.x+this.cellSize*e)}},{key:"getCellBorderY",value:function(e){return Math.floor(this.minefieldBounds.y+this.cellSize*e)}},{key:"getCellBounds",value:function(e,t){var i=this.getCellBorderX(e),n=this.getCellBorderY(t);return{x:i,y:n,width:this.getCellBorderX(e+1)-i,height:this.getCellBorderY(t+1)-n}}}])&&h(t.prototype,i),n&&h(t,n),e}();function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}new(function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"mouseDownCell",null),l(this,"isMouseCaptured",!1),this.game=t;var o=document.createElement("canvas"),a=o.getContext("2d");if(!a)throw"Unable to obtain a 2D drawing context.";this.context=a,this.minefieldContainer=i,i.appendChild(o),window.addEventListener("resize",(function(){return n.refreshCanvasLayout()})),this.refreshCanvasLayout(),o.addEventListener("mousedown",(function(e){return n.onMouseDown(e)})),o.addEventListener("mousemove",(function(e){return n.onMouseMove(e)})),o.addEventListener("mouseup",(function(e){return n.onMouseUp(e)})),o.addEventListener("dblclick",(function(e){return n.onDoubleClick(e)})),window.addEventListener("contextmenu",(function(e){return e.preventDefault()}),!1)}var t,o,a;return t=e,a=[{key:"areSame",value:function(e,t){return e?!!t&&e.x===t.x&&e.y===t.y:!t}}],(o=[{key:"refreshCanvasLayout",value:function(){var e=window.devicePixelRatio||1,t=this.minefieldContainer.clientWidth*e,i=this.minefieldContainer.clientHeight*e;if(!this.layout||this.layout.renderSize.width!==t||this.layout.renderSize.height!==i){this.layout=new r(t,i,this.game.width,this.game.height);var n=this.context.canvas;n.style.width=this.minefieldContainer.clientWidth+"px",n.style.height=this.minefieldContainer.clientHeight+"px",n.width=t,n.height=i,this.render()}}},{key:"onMouseDown",value:function(e){if(!this.game.conclusion)if(0===e.button)this.isMouseCaptured=!0,this.updateMouseDownCell(e);else if(2===e.button){var t=this.getCellByMouseLocation(e);t&&this.game.tryToggleMark(t.x,t.y)&&this.render()}}},{key:"onMouseMove",value:function(e){this.isMouseCaptured&&this.updateMouseDownCell(e)}},{key:"onMouseUp",value:function(e){0===e.button&&(this.isMouseCaptured=!1,this.mouseDownCell&&(this.game.tryOpen(this.mouseDownCell.x,this.mouseDownCell.y),this.mouseDownCell=null,this.render()))}},{key:"onDoubleClick",value:function(e){if(!this.game.conclusion&&0===e.button){var t=this.getCellByMouseLocation(e);t&&this.game.openSurroundingIfSatisfied(t.x,t.y)&&this.render()}}},{key:"updateMouseDownCell",value:function(t){var i=this.getCellByMouseLocation(t);e.areSame(i,this.mouseDownCell)||(this.mouseDownCell=i,this.render())}},{key:"getCellByMouseLocation",value:function(e){var t=window.devicePixelRatio||1;return this.layout.getCellCoordinatesByMouseLocation({x:e.offsetX*t,y:e.offsetY*t})}},{key:"render",value:function(){var e=this.layout,t=e.renderSize,i=e.minefieldBounds,n=e.cellSize;this.context.clearRect(0,0,t.width,t.height),this.context.fillStyle="#d0d0d0",this.context.fillRect(i.x,i.y,i.width,i.height),this.context.strokeStyle="#a0a0a0";for(var o=0;o<this.game.height;o++){var a=this.layout.getCellBorderY(o);this.context.beginPath(),this.context.moveTo(i.x,a),this.context.lineTo(i.x+i.width,a),this.context.stroke()}for(var h=0;h<this.game.width;h++){var r=this.layout.getCellBorderX(h);this.context.beginPath(),this.context.moveTo(r,i.y),this.context.lineTo(r,i.y+i.height),this.context.stroke()}this.context.font="bold "+.5*n+"px Georgia";for(var s=0;s<this.game.height;s++)for(var l=0;l<this.game.width;l++)this.drawCell({x:l,y:s},this.layout.getCellBounds(l,s),n)}},{key:"drawCell",value:function(e,t,o){var a=e.x,h=e.y,r=this.mouseDownCell&&this.mouseDownCell.x===a&&this.mouseDownCell.y===h,s=this.game.getCellAt(a,h);if(s instanceof i&&(s.marked||!r)){var l=.1*o,u=t.x+t.width,d=t.y+t.height;this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(t.x,d),this.context.lineTo(t.x+l,d-l),this.context.lineTo(t.x+l,t.y+l),this.context.lineTo(u-l,t.y+l),this.context.lineTo(u,t.y),this.context.closePath(),this.context.fillStyle="#e8e8e8",this.context.fill(),this.context.beginPath(),this.context.moveTo(u,d),this.context.lineTo(u,t.y),this.context.lineTo(u-l,t.y+l),this.context.lineTo(u-l,d-l),this.context.lineTo(t.x+l,d-l),this.context.lineTo(t.x,d),this.context.closePath(),this.context.fillStyle="#a0a0a0",this.context.fill()}var c=s instanceof i?s.marked?"ðŸš©":null:s instanceof n?0!==s.mineCount?s.mineCount.toString():null:"ðŸ’¥";null!==c&&(s instanceof n&&(this.context.fillStyle=["blue","green","#e00","darkblue","brown","darkcyan","black","gray"][s.mineCount-1]),this.drawCenteredText(c,t))}},{key:"drawCenteredText",value:function(e,t){var i=this.context.measureText(e);this.context.textBaseline="middle",this.context.fillText(e,t.x+(t.width-i.width)/2,t.y+t.height/2)}}])&&s(t.prototype,o),a&&s(t,a),e}())(new a(30,16,99),document.getElementById("minefield-container"))}();
//# sourceMappingURL=index.6c311a84.js.map
